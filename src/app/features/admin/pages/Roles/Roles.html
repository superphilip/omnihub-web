@if (loading) {
  <custom-loading message="Cargando roles..."></custom-loading>
} @else {
  <div class="flex flex-col gap-4">

    <custom-header-table
      [title]="'GESTOR DE ROLES'"
      [subtitle]="'Gestiona y visualiza los roles del sistema'"
      [search]="searchHuman()"
      (requestOpen)="openAdd()"
      (searchChange)="onSearchChange($event)"
      (searchSubmit)="forceSearchNow()"
      (searchBlur)="forceSearchNow()">              <!-- Blur: dispara inmediato -->

      <div header-tools>
        <custom-columns-visible
          [columns]="allColumns()"
          [hidden]="hiddenColumns()"
          (toggle)="toggleColumn($event)"
          (showAll)="showAllColumns()"
          (hideAll)="hideAllColumns()">
        </custom-columns-visible>
      </div>
    </custom-header-table>

    <div class="w-full overflow-x-auto border border-gray-100 rounded-xl bg-white shadow-sm">
      <custom-table
        [rows]="rows"
        [columns]="columns()"
        [meta]="meta"
        (pageChange)="setPage($event)"
        (sortChange)="onSort($event)">
      </custom-table>

      @if (meta) {
        <div class="px-6 py-2 text-xs text-gray-500">
          Mostrando
          <span class="font-semibold text-[#2B5797]">{{ rangeStart }}</span>â€“<span class="font-semibold text-[#2B5797]">{{ rangeEnd }}</span>
          de <span class="font-semibold text-[#2B5797]">{{ meta.total }}</span>
        </div>
      }
    </div>
  </div>

  @if (fetching && rows.length === 0) {
    <div class="text-center py-20 text-gray-400">
      <i class="fa-solid fa-folder-open text-3xl mb-2"></i>
      <p>No hay roles para mostrar.</p>
    </div>
  }
}

<custom-modal [open]="adding()" [title]="'Nuevo rol'" (close)="closeAdd()">
  <div modal-body>
    <role-form
      [formGroup]="form"
      [pending]="createMutation.isPending()"
      (submitForm)="submitRole($event)"
      (cancel)="closeAdd()">
    </role-form>
  </div>
  <div modal-footer></div>
</custom-modal>
