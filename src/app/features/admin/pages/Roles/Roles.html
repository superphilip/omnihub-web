<div class="flex flex-col gap-4">
  <custom-header-table [title]="'GESTOR DE ROLES'" [subtitle]="'Gestiona y visualiza los roles del sistema'"
    [search]="search()" (searchChange)="onSearchChange($event)" (searchSubmit)="forceSearchNow()"
    (searchBlur)="forceSearchNow()" (requestOpen)="openCreateRoleModal()">
    <div header-tools class="flex items-center gap-2">
      <div class="inline-block text-xs font-semibold text-[#2B5797] bg-blue-50 rounded-lg px-1 py-2
                  shadow-sm border border-blue-100">
        @if (totalCount() > 0) {
          Mostrando
          <span>{{ rangeStart() }}</span> –
          <span>{{ rangeEnd() }}</span>
          de <span>{{ totalCount() }}</span>
          registros
        } @else {
          Sin registros para mostrar
        }
      </div>
      <!-- Aquí puedes agregar otros controles como paginador-per-page -->
      <!--
      <label class="text-xs text-gray-500">Registros por página</label>
      <select ...></select>
      -->
    </div>
  </custom-header-table>

  <div [style.min-height.px]="minHeight()" [style.transition]="'min-height 0.2s'">
    @if (query.isError()) {
    <div class="flex items-center gap-2 text-red-600 px-6 py-4">
      <i class="fa-solid fa-triangle-exclamation"></i>
      <span>Ocurrió un error cargando roles.</span>
      <code class="text-xs text-red-700 bg-red-50 px-2 py-1 rounded">{{ formatQueryError(query.error()) }}</code>
      <button class="btn btn-sm ml-auto" (click)="query.refetch()">Reintentar</button>
    </div>
    } @else if (query.isPending()) {
    <div class="flex items-center justify-center py-12 text-[#2B5797]">
      <i class="fa-solid fa-spinner animate-spin mr-2"></i>
      <span>Cargando roles...</span>
    </div>
    } @else {
    <tan-table [data]="rows()" [columns]="columns()" [pageSize]="pageSize()" [globalFilter]="formattedSearch()"
      [totalPagesIn]="pageCount()" [totalCountIn]="totalCount()" (pageChange)="setPage($event)"
      [currentPageIn]="pageIndex()" (sortingChange)="onSortingChange($event)" [rowActions]="rowMenuItems"
      (edit)="onEdit($event)" (details)="onDetails($event)" (delete)="onDelete($event)">
    </tan-table>
    }
  </div>

  <custom-modal [open]="createRoleModalOpen()" [title]="'Crear nuevo rol'" (close)="closeCreateRoleModal()"
    [maxWidth]="'540px'">
    <role-form [formGroup]="createRoleForm()" [mutationFn]="svc.createRoleMutation.mutate" (success)="query.refetch()"
      (cancel)="closeCreateRoleModal()" modal-body>
    </role-form>
  </custom-modal>
</div>
